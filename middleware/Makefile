# ==============================================================================
# Go Application Management
# ==============================================================================
.PHONY: run build clean tidy test

# è®¾ç½®å˜é‡
APP_NAME := my-redis-app
CMD_PATH := cmd/app/main.go
OUTPUT_DIR := bin

# è¿è¡Œ Go åº”ç”¨ç¨‹åº
run:
	@echo "ğŸƒ Running the application..."
	go run $(CMD_PATH)

# ç¼–è¯‘ Go åº”ç”¨ç¨‹åº
build:
	@echo "ğŸ”¨ Building the application..."
	go build -o $(OUTPUT_DIR)/$(APP_NAME) $(CMD_PATH)
	@echo "âœ… Build complete: $(OUTPUT_DIR)/$(APP_NAME)"

# æ¸…ç†ç¼–è¯‘äº§ç‰©
clean:
	@echo "ğŸ§¹ Cleaning up built files..."
	rm -rf $(OUTPUT_DIR)
	@echo "âœ… Cleanup complete."

# æ•´ç† Go æ¨¡å—ä¾èµ–
tidy:
	@echo "ğŸ“¦ Tidying Go modules..."
	go mod tidy
	@echo "âœ… Modules tidied."

# è¿è¡Œå•å…ƒæµ‹è¯•
test:
	@echo "ğŸ§ª Running tests..."
	go test ./... -v

# ==============================================================================
# Docker Redis Management
# ==============================================================================
# Redis Docker ç®¡ç† Makefile

.PHONY: start-redis stop-redis restart-redis logs-redis

# å¯åŠ¨ Redis æœåŠ¡
start-redis:
	@echo "ğŸš€ å¯åŠ¨ Redis æœåŠ¡..."
	cd deploy/ && docker-compose up -d
	@echo "âœ… Redis æœåŠ¡å·²å¯åŠ¨"

# åœæ­¢ Redis æœåŠ¡
stop-redis:
	@echo "ğŸ›‘ åœæ­¢ Redis æœåŠ¡..."
	cd deploy/ && docker-compose down
	@echo "âœ… Redis æœåŠ¡å·²åœæ­¢"

# é‡å¯ Redis æœåŠ¡
restart-redis:
	@echo "ğŸ”„ é‡å¯ Redis æœåŠ¡..."
	cd deploy/ && docker-compose restart
	@echo "âœ… Redis æœåŠ¡å·²é‡å¯"

# æŸ¥çœ‹ Redis æ—¥å¿—
logs-redis:
	@echo "ğŸ“ æŸ¥çœ‹ Redis æ—¥å¿—..."
	cd deploy/ && docker-compose logs -f redis
