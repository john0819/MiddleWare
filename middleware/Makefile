# ==============================================================================
# Go Application Management
# ==============================================================================
.PHONY: run build clean tidy test

# è®¾ç½®å˜é‡
APP_NAME := my-redis-app
CMD_PATH := cmd/app/main.go
OUTPUT_DIR := bin

# è¿è¡Œ Go åº”ç”¨ç¨‹åº
run:
	@echo "ğŸƒ Running the application..."
	go run $(CMD_PATH)

# ç¼–è¯‘ Go åº”ç”¨ç¨‹åº
build:
	@echo "ğŸ”¨ Building the application..."
	go build -o $(OUTPUT_DIR)/$(APP_NAME) $(CMD_PATH)
	@echo "âœ… Build complete: $(OUTPUT_DIR)/$(APP_NAME)"

# æ¸…ç†ç¼–è¯‘äº§ç‰©
clean:
	@echo "ğŸ§¹ Cleaning up built files..."
	rm -rf $(OUTPUT_DIR)
	@echo "âœ… Cleanup complete."

# æ•´ç† Go æ¨¡å—ä¾èµ–
tidy:
	@echo "ğŸ“¦ Tidying Go modules..."
	go mod tidy
	@echo "âœ… Modules tidied."

# è¿è¡Œå•å…ƒæµ‹è¯•
test:
	@echo "ğŸ§ª Running tests..."
	go test ./... -v

# ==============================================================================
# Docker Redis Management
# ==============================================================================
# Redis Docker ç®¡ç† Makefile

.PHONY: start-mw stop-mw restart-mw logs-mw

# å¯åŠ¨ä¸­é—´ä»¶æœåŠ¡
start-mw:
	@echo "ğŸš€ å¯åŠ¨ä¸­é—´ä»¶æœåŠ¡..."
	cd deploy/ && docker-compose up -d
	@echo "âœ… ä¸­é—´ä»¶æœåŠ¡å·²å¯åŠ¨"

# åœæ­¢ä¸­é—´ä»¶æœåŠ¡
stop-mw:
	@echo "ğŸ›‘ åœæ­¢ä¸­é—´ä»¶æœåŠ¡..."
	cd deploy/ && docker-compose down
	@echo "âœ… ä¸­é—´ä»¶æœåŠ¡å·²åœæ­¢"

# é‡å¯ä¸­é—´ä»¶æœåŠ¡
restart-mw:
	@echo "ğŸ”„ é‡å¯ä¸­é—´ä»¶æœåŠ¡..."
	cd deploy/ && docker-compose restart
	@echo "âœ… ä¸­é—´ä»¶æœåŠ¡å·²é‡å¯"

# æŸ¥çœ‹ä¸­é—´ä»¶æ—¥å¿—
logs-mw:
	@echo "ğŸ“ æŸ¥çœ‹ä¸­é—´ä»¶æ—¥å¿—..."
	cd deploy/ && docker-compose logs -f redis
